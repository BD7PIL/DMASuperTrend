🚀 DMASuperTrend量化交易系统 - 核心项目需求
📊 项目愿景
构建一个基于双均线(DMA)和超级趋势(SuperTrend)的智能量化交易系统，具备自适应时间框架选择能力，实现多交易所自动化交易，核心目标是：稳定盈利，严格风控，自动化运行。

🎯 核心交易理念
动态时间框架策略：系统自动确定最佳交易级别（15分钟/1小时/4小时等）

市场状态自适应：趋势行情用DMA+SuperTrend，横盘行情切换合适策略

智能资金管理：小资金大杠杆，大资金小杠杆，快速翻仓原则

严格风险控制：分批移动止盈+硬止损，单笔损失≤2%总资金

🏗️ 系统核心模块
1. 交易所集成层
支持币安、OKX、Bitget三个交易所

多账户独立配置，互不干扰

开发阶段：仅启用1个OKX模拟账户

统一API接口，支持快速切换交易所

2. 数据管理与缓存系统
实时市场数据采集（K线、深度、成交）

三级缓存架构：内存 → Redis → 数据库

支持离线回测，减少API调用

数据预处理和特征工程流水线

3. 策略引擎（核心）
3.1 时间框架优化器
自动选择最佳交易时间框架

评估维度：波动率、资金规模、策略类型、交易频率

动态调整：基于市场状态和交易结果

3.2 市场状态分类器
轻量级机器学习模型（RandomForest/LightGBM）

输入：技术指标组合（RSI, MACD, Bollinger, ATR等）

输出：市场状态（趋势/横盘）

实时更新和在线学习

3.3 双均线+超级趋势策略
双均线参数：fast_ma=9, slow_ma=21（可自适应调整）

超级趋势参数：period=10, multiplier=3

信号确认机制：金叉+SuperTrend看涨 → 买入

3.4 策略切换器
平滑切换机制：不清仓，逐步调整

切换条件：连续3个K线确认状态变化

横盘备用策略：均值回归或网格交易

4. 资金与风险管理系统
4.1 动态仓位计算
text
资金规模 < 10,000U → 杠杆20倍
资金规模 10,000-100,000U → 杠杆10倍  
资金规模 > 100,000U → 杠杆3-5倍
单笔风险：总资金的2%
4.2 分批止盈止损
分批止盈：

30%仓位：1.5倍止盈

30%仓位：2.0倍止盈

40%仓位：移动止盈（回撤3%平仓）

硬止损：入场价±2%

日最大亏损：总资金5%

5. 回测优化系统
多线程并行回测，自动分配计算资源

支持币种独立回测（实盘BTC时可回测ETH）

参数优化：贝叶斯优化+遗传算法

回测报告：夏普率、最大回撤、胜率、盈亏比

6. 实盘交易系统
事件驱动架构：MarketEvent → SignalEvent → OrderEvent

订单状态管理：PENDING → FILLED/CANCELLED/REJECTED

异常处理：网络断开自动重连，订单异常恢复

动态参数调整：基于最近20笔交易结果优化参数

7. 监控与通知系统
7.1 Telegram机器人
实时通知：开仓/平仓/止损

定时报告：日报/周报/月报

查询功能：/status, /positions, /balance

远程控制：/pause, /resume, /shutdown

7.2 前端监控面板
实时K线图表（Plotly交互式）

策略参数可视化调整

持仓状态和盈亏统计

回测任务控制面板

系统性能监控仪表盘

🔄 系统工作流程
交易流程
text
1. 数据采集 → 2. 市场状态判断 → 3. 时间框架选择 → 
4. 策略信号生成 → 5. 风险计算 → 6. 订单执行 → 
7. 持仓管理 → 8. 止盈止损监控 → 9. 业绩记录
开发流程
text
Phase 1: 基础框架 (2周)
  ✓ 交易所API封装（OKX优先）
  ✓ 数据缓存系统
  ✓ 基础回测引擎
  
Phase 2: 策略实现 (2周)
  ✓ DMA+SuperTrend核心策略
  ✓ 市场状态分类器
  ✓ 时间框架选择器
  
Phase 3: 风控实盘 (1周)
  ✓ 资金管理系统
  ✓ 实盘交易引擎
  ✓ Telegram通知
  
Phase 4: 高级功能 (2周)
  ✓ 多线程回测优化
  ✓ Streamlit前端界面
  ✓ 动态参数调整
  
Phase 5: 测试部署 (1周)
  ✓ 模拟交易测试
  ✓ 性能优化
  ✓ 部署文档
📊 性能指标要求
回测性能
1000个交易日数据回测 < 30秒（8核CPU）

内存使用 < 2GB（100个交易对）

磁盘IO优化：缓存命中率 > 80%

实时性能
数据延迟 < 500ms

订单执行延迟 < 100ms

前端响应时间 < 1秒

系统可靠性
可用性：99.9%

最大回撤：< 20%

胜率：> 45%

盈亏比：> 1.5

🔐 安全与合规
数据安全
API密钥加密存储（环境变量或Vault）

交易数据加密传输

操作日志完整记录

定期数据备份

风险控制
熔断机制：连续亏损3次暂停交易

最大仓位限制：单币种不超过30%

杠杆限制：根据资金规模动态调整

滑点控制：市场订单最大滑点2%

🎮 用户交互设计
前端界面功能
实时监控面板

K线图+策略信号叠加

账户余额和盈亏曲线

当前持仓和未实现盈亏

策略控制面板

策略参数实时调整

交易开关控制

杠杆和风险设置

回测控制面板

回测任务创建和管理

进度实时显示

结果对比和分析

系统管理面板

日志查看和筛选

性能监控图表

系统健康状态

Telegram指令集
text
基础指令：
/start - 启动系统
/status - 系统状态
/positions - 当前持仓
/balance - 账户余额

交易控制：
/buy [symbol] [amount] - 手动买入
/sell [symbol] [amount] - 手动卖出
/pause - 暂停交易
/resume - 恢复交易

查询指令：
/kpi - 查看关键指标
/report daily - 生成日报
/report weekly - 生成周报
/config - 查看当前配置

管理指令：
/set_leverage [value] - 设置杠杆
/set_risk [percent] - 设置风险比例
/update_strategy - 更新策略参数
/shutdown - 安全关闭系统
🛠️ 技术实施要点
关键技术决策
时间框架选择算法：基于波动率+资金规模的决策树

机器学习模型：轻量级RandomForest，实时更新

缓存策略：热点数据内存缓存，历史数据Redis

并发处理：异步IO + 多线程回测

开发环境集成
memory bank：存储项目架构和决策

file system：管理项目文件结构

context7：处理复杂代码逻辑

GitHub：版本控制和协作

fetch：获取市场数据和文档

Windows适配注意事项
路径处理使用Pathlib跨平台兼容

PowerShell命令替代bash命令

Windows服务管理（Redis, PostgreSQL）

虚拟环境激活使用Scripts目录

📈 成功标准
第一阶段成功标准
OKX模拟账户可以正常运行

基础回测系统工作正常

DMA+SuperTrend策略能生成信号

数据缓存系统有效减少API调用

第二阶段成功标准
时间框架选择器能正确推荐周期

市场状态分类准确率 > 70%

资金管理系统计算仓位正确

Telegram机器人能发送通知

最终成功标准
系统7x24小时稳定运行

实盘交易年化收益率 > 30%

最大回撤 < 15%

自动化程度 > 95%

项目核心需求明确：这是一个专业级量化交易系统，需要平衡策略复杂度与执行效率，在确保风险可控的前提下追求稳定收益。系统设计遵循模块化原则，便于后期扩展和维护。